--- tools/clang/lib/Driver/Tools.cpp.orig	2014-09-08 12:39:35.000000000 +0200
+++ tools/clang/lib/Driver/Tools.cpp	2014-09-08 14:29:14.000000000 +0200
@@ -214,6 +214,17 @@
   //                and only supported on native toolchains.
   if (!TC.isCrossCompiling())
     addDirectoryList(Args, CmdArgs, "-L", "LIBRARY_PATH");
+
+  // Add -L<prefix>/lib to default linker arguments. This is needed to
+  // find libc++ automatically.
+  // On Linux add also -rpath.
+  if (!TC.isCrossCompiling()) {
+    CmdArgs.push_back(Args.MakeArgString("-L" + D.InstalledDir + "/../lib"));
+    if (TC.getTriple().getOS() == llvm::Triple::Linux) {
+      CmdArgs.push_back(Args.MakeArgString("-rpath=" + D.InstalledDir + "/../lib"));
+    }
+  }
+
 }
 
 /// \brief Determine whether Objective-C automated reference counting is
--- projects/compiler-rt/CMakeLists.txt	(revision 217380)
+++ projects/compiler-rt/CMakeLists.txt	(working copy)
@@ -342,9 +342,9 @@
   string(REGEX MATCH "-mmacosx-version-min="
          MACOSX_VERSION_MIN_FLAG "${CMAKE_CXX_FLAGS}")
   set(SANITIZER_COMMON_SUPPORTED_DARWIN_OS osx)
-  if (IOSSIM_SDK_DIR AND NOT MACOSX_VERSION_MIN_FLAG)
-    list(APPEND SANITIZER_COMMON_SUPPORTED_DARWIN_OS iossim)
-  endif()
+#  if (IOSSIM_SDK_DIR AND NOT MACOSX_VERSION_MIN_FLAG)
+#    list(APPEND SANITIZER_COMMON_SUPPORTED_DARWIN_OS iossim)
+#  endif()
 
   if(COMPILER_RT_USES_LIBCXX)
     set(SANITIZER_MIN_OSX_VERSION 10.7)
